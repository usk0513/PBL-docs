# 開発環境と環境構築の重要性
<small>情報系大学院PBL (アジャイル開発)</small>
cover illustration

---
## アジェンダ
1. 環境の話をする理由
2. 複数環境の種類と役割
3. 本授業の環境アーキテクチャ
4. 技術スタック & リポジトリ構成
5. ローカル開発環境の整備
6. 演習内容
7. まとめ

---
## なぜ環境が重要なのか？
ソフトウェアが自分のPCで動いても、他人のマシンや本番環境では動かないことがよくあります[1]。原因は OS や設定の違い、環境変数、依存ライブラリ、実行モードの違いなどさまざまです[2]。
- 俺の環境では動く」問題 – 環境差異が原因でバグが再現できず時間を浪費
- 安全な試行のための分離 – 本番環境を壊さないよう、開発用の砂場が必要
- チームメンバー間の統一 – 複数人で開発するときは全員が同じ環境であることが重要

---
## OS差異による問題例
- 改行コード・ファイルパスの違い – WindowsとmacOS/Linuxでは改行コードやパス区切りが異なり、同じスクリプトでも挙動が変わる。
- ファイル名の大文字小文字 – macOS標準のファイルシステムは大文字小文字を区別しませんが、Linuxでは区別するためバグの原因になる。
- 依存パッケージやアーキテクチャ – ARMチップ（M1など）とIntelでビルドしたバイナリが互換性を持たないことがある[3]。
このような差異を吸収するために共通の環境を用意する必要があります。

---
## 複数環境の種類と役割
開発プロセスでは一般的に複数の環境を使い分けます。
- 開発環境 (Dev) – 開発者が機能追加やデバッグを行うための砂場。実験的な変更を安全に試せます[4]。
- テスト／ステージング環境 (Test/Staging) – 本番に近い構成で動作確認や品質保証を行う場所。最終リリース前の検証を行います。
- 本番環境 (Production) – 実際のユーザーが利用する環境。安定性と安全性が最優先で、信頼できるコードのみデプロイします。
開発環境とテスト環境の構成を本番とできるだけ揃えることで、環境差による不具合を減らせます。

---
## 環境の流れ
開発の流れを図示すると以下のようになります：
環境の流れ

ローカルで試したコードをチームの開発VMに統合し、最終的に本番VMへデプロイします。ステージング環境がある場合は、本番前にそこで最終確認を行います。

---
## 授業の環境アーキテクチャ
今回のPBLでは、大学が提供するオンプレミスサーバー上に複数の仮想マシン(VM)を用意します。
- 本番環境用VM: クラス全体の最終成果物を動かすサーバー。安定版コードのみデプロイします。
- チーム開発環境用VM: 各チームに1台ずつ割り当てられ、自由に実験や検証ができるサーバー。
- ローカル開発環境: 各自のPC上の環境。Dockerなどで統一します。
この構成により、他チームの作業に影響を与えずに開発できます。

---
## 技術スタックとリポジトリ構成
- フレームワーク – Python & Django。学生が既に触れたことのある技術を採用し、学習コストを抑えます。
- 単一リポジトリ – 全チームが同じGitリポジトリを共有。チームごとにディレクトリを分けてプロダクトを管理します。
リポジトリ構成

各チームは自分のディレクトリ内で作業し、他チームのコードを参考にできますが、勝手に変更してはいけません。共通部分のルールやコード品質はクラス全体で相談しながら決めていきます。

---
## ローカル開発環境の整備
環境差異を減らすため、ローカル環境はできるだけ統一しましょう。
- Dockerの利用 – DockerfileとDocker-compose.ymlを用意し、全員が同じバージョンのPython・Django・DBを使用できるようにします。コンテナ化された開発環境はOSの違いによる不具合を解消します。
- 他の方法も検討 – WSL2や仮想マシンを用いた環境でも構いません。ただし、チーム内でPythonバージョンや依存ライブラリのバージョンを揃えることが重要です。
- 仮想環境ツールの活用 – venvなどでグローバル環境と隔離し、requirements.txtやpoetry.lockで依存関係を共有しましょう。
- ドキュメント – 環境構築手順や注意点をREADMEにまとめ、チーム全員が再現できるようにします。
コンテナ化された開発環境は「It works on my machine」問題の多くを解決します。
---
## 演習: 手を動かしてみよう
初回講義では以下の演習を行います。チーム単位で協力して進めてください。
1.	リポジトリのクローン – 全員でGitリポジトリをクローンし、チームディレクトリを確認します。
2.	ローカル環境構築 – Dockerや仮想環境を使ってローカル開発環境を構築し、サーバーを起動します。うまくいった手順をチーム内で共有しましょう。
3.	Djangoプロジェクトの雛形作成 – 自分のチームディレクトリにdjango-admin startprojectでプロジェクトを作成します。
4.	動作確認 – ブラウザでhttp://localhost:8000にアクセスし、Djangoの初期ページが表示されることを確認します。チームVM上での起動も試します。
5.	振り返り – 環境構築で得た知見や問題点をまとめ、クラス全体で共有します。別のチームの工夫を取り入れることでより良い環境を構築しましょう。
---
## まとめと次のステップ
- 環境は品質の土台 – OSや依存関係の違いによって「自分のPCでは動く」が発生するため、環境を揃えることが最重要です[5]。
- 複数環境を活用 – 開発・テスト・本番環境を分け、各段階で安全に試行錯誤することで本番の安全性を高めます[4]。
- 共有と協力 – 単一リポジトリと共通の技術スタックにより、クラス全体で知見を共有しながらプロダクトを磨き上げましょう。
- 自分たちで最適解を探す – ツールやフローは提案しますが、より良い方法を自分たちで模索し、クラス全体に還元する姿勢を大切にしてください。
この環境構築の理解を踏まえ、次回以降は実際の開発サイクルに入っていきます。楽しみながら学んでいきましょう！

---
[1] [2] [3] [5]  [It works on my machine. Why?](https://thoughtbot.com/blog/it-works-on-my-machine-why)
[4] [Dev, QA, preview, test, staging, and production environments. What's the deal? | Blog — Northflank](https://northflank.com/blog/what-are-dev-qa-preview-test-staging-and-production-environments)
